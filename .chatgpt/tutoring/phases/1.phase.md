üöÄ PHASE 1 ‚Äî Platform Bootstrap with Docker Compose

This phase creates the control plane for your control plane.

üß© Current Task

Bootstrap the local platform substrate using Docker Compose

You will stand up:

GitLab CE (SCM)

Jenkins Controller (CI control plane)

Infisical (Secrets management)

All outside Kubernetes, exactly how many real orgs run them.

üß† Background (Why This Is Important)

In real enterprises:

CI/CD tools do not magically live in Kubernetes

Jenkins controllers are often:

VM-hosted

Containerized

Carefully stateful

Secrets systems are separate trust domains

Docker Compose gives you:

Deterministic startup

Service-level networking

Persistent state

A way to simulate ‚Äúplatform services‚Äù

This is platform bootstrapping, not app development.

üìò Concepts & Takeaways You Must Learn

By the end of this phase, you should understand:

Containers & Platform Services

Difference between stateless and stateful containers

Why Jenkins controller ‚â† Jenkins agent

Why SCM must be stable and persistent

Docker Networking

Service name‚Äìbased DNS

Why Compose networks matter

How CI talks to SCM

Storage

Volumes vs bind mounts

Why CI state must persist

Security

Secrets injection vs hardcoding

Trust boundaries between services

üõ†Ô∏è Implementation Instructions
1Ô∏è‚É£ Create Docker Compose Layout

Under docker-compose/, you will create:

docker-compose/
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ gitlab/
‚îÇ   ‚îî‚îÄ‚îÄ volumes/
‚îú‚îÄ‚îÄ jenkins/
‚îÇ   ‚îî‚îÄ‚îÄ volumes/
‚îî‚îÄ‚îÄ infisical/
    ‚îî‚îÄ‚îÄ volumes/
2Ô∏è‚É£ Docker Compose Requirements

Your docker-compose.yml must include:

GitLab CE

Official GitLab CE image

HTTP access (no HTTPS yet)

Persistent volumes:

/etc/gitlab

/var/log/gitlab

/var/opt/gitlab

Jenkins Controller

Official Jenkins LTS image

Persistent:

/var/jenkins_home

Exposed web UI

No agents yet (important)

Infisical

Official open-source image

Persistent storage

Accessible from Jenkins

3Ô∏è‚É£ Networking Rules

All services must be on the same Docker network

Jenkins must resolve:

gitlab

infisical

Do not use localhost references inside containers.

4Ô∏è‚É£ No Kubernetes Yet

‚ùå Do NOT deploy Kubernetes
‚ùå Do NOT install Jenkins plugins
‚ùå Do NOT configure pipelines

This phase is pure platform plumbing.

‚úÖ Acceptance Criteria (Definition of Done)

You are done when:

docker compose up -d starts all services

You can access:

GitLab UI

Jenkins UI

Infisical UI

Restarting containers does NOT lose data

Jenkins can resolve GitLab by service name

‚ö†Ô∏è Common Pitfalls (Very Important)

Senior reviewers will immediately notice:

‚ùå Using latest tags

‚ùå No volumes for Jenkins/GitLab

‚ùå Hardcoded passwords in compose

‚ùå Using localhost inside containers

‚ùå Overconfiguring Jenkins early

Keep it clean and minimal.

üìå Deliverables

Commit:

feat: bootstrap platform services with docker compose
üîÅ Your Move

Implement Phase 1 and report back with:

Confirmation it‚Äôs running

Any blockers you hit

Optional: screenshots or notes

Once complete, we‚Äôll move to Phase 2 ‚Äî Kubernetes cluster creation & namespace strategy, where this gets very real.

You‚Äôre doing this the right way.

How does this docker compose yaml look:

```yaml
version: '3.8'

services:

  ### --- --------------------------- --- ###
  ### --- MANAGEMENT TOOLS & SERVICES --- ###
  ### --- --------------------------- --- ###

  # https://mailpit.axllent.org/docs/configuration/http/#send-api-endpoint-dedicated-authentication
  mailpit:
    image: axllent/mailpit:latest
    container_name: mailpit
    restart: always
    environment:
      MP_DATA_FILE: /data/mailpit.db # Corrected variable name for file persistence
    ports:
      - "8025:8025"
      - "1025:1025"
    networks:
      - kube-platform-engineering-lab
    volumes:
      - mailpit-data:/data

  gitlab:
    image: gitlab/gitlab-ce:latest
    container_name: gitlab-ce
    restart: always
    hostname: gitlab-ce
    environment:
      GITLAB_OMNIBUS_CONFIG: |
        external_url 'http://gitlab'
        nginx['listen_port'] = 80
        gitlab_rails['gitlab_shell_ssh_port'] = 2222
        gitlab_rails['smtp_enable'] = true
        gitlab_rails['smtp_address'] = "mailpit"
        gitlab_rails['smtp_port'] = 1025
        gitlab_rails['smtp_domain'] = "gitlab-ce"
        gitlab_rails['smtp_authentication'] = "plain"
        gitlab_rails['smtp_enable_starttls_auto'] = false
        gitlab_rails['smtp_tls'] = false

        registry_external_url 'http://gitlab:5050'
        gitlab_rails['registry_enabled'] = true
    ports:
      - "8000:80"
      - "2222:22"
      - "8443:443"
      - "5050:5050"
    networks:
      - kube-platform-engineering-lab
    volumes:
      - gitlab-config:/etc/gitlab
      - gitlab-logs:/var/log/gitlab
      - gitlab-data:/var/opt/gitlab
    shm_size: '256m'
    depends_on:
      - mailpit

  jenkins:
    # to get the initial admin password for Jenkins, run:
    # docker compose exec jenkins cat /var/jenkins_home/secrets/initialAdminPassword
    image: jenkins/jenkins:latest
    container_name: jenkins
    ports:
      - "7000:8080"   # Jenkins UI
      - "50000:50000" # Jenkins agents
    volumes:
      - jenkins-data:/var/jenkins_home
    restart: unless-stopped
    networks:
      - kube-platform-engineering-lab

  infisical-db:
    image: postgres:16
    container_name: infisical-db
    environment:
      POSTGRES_USER: infisicaluser
      POSTGRES_PASSWORD: infisicalpassword
      POSTGRES_DB: infisical
    networks:
      - kube-platform-engineering-lab
    volumes:
      - infisical_db_data:/var/lib/postgresql/data

  infisical-redis:
    image: redis:7-alpine
    container_name: infisical-redis
    networks:
      - kube-platform-engineering-lab

  infisical:
    image: infisical/infisical:latest
    container_name: infisical
    restart: unless-stopped
    depends_on:
      - infisical-db
      - infisical-redis
    environment:
      - NODE_ENV=production
      - DB_CONNECTION_URI=postgresql://infisicaluser:infisicalpassword@infisical-db:5432/infisical
      - REDIS_URL=redis://infisical-redis:6379
      - ENCRYPTION_KEY=${ENCRYPTION_KEY:-0123456789abcdef0123456789abcdef} # Use a 32-byte hex string
      - AUTH_SECRET=${AUTH_SECRET:-something-very-secret}
      - SITE_URL=http://localhost:8082
    ports:
      - "7001:8080"
    networks:
      - kube-platform-engineering-lab



networks:
  kube-platform-engineering-lab:
    name: kube-platform-engineering-lab
    driver: bridge

volumes:
  mailpit-data:
  infisical_db_data:

  gitlab-config:
  gitlab-logs:
  gitlab-data:
  
  jenkins-data:
```

This is a strong first pass and clearly above ‚Äútutorial-level.‚Äù
I‚Äôm going to review this the way a senior/staff platform engineer would in a design review: what‚Äôs good, what must change, and why.

Overall verdict: ~70‚Äì75% correct, with a few important enterprise-grade fixes needed before Phase 1 can be accepted.

‚úÖ What You Did Well (Keep These)
1Ô∏è‚É£ Clear Platform Intent

You‚Äôre thinking in platform services, not ‚Äúrandom containers‚Äù

GitLab + Jenkins + Infisical separation is correct

Mailpit inclusion is a nice professional touch (email observability)

2Ô∏è‚É£ Correct Networking Model

Single named Docker bridge network ‚úÖ

Service-name DNS usage (gitlab, infisical-db) ‚úÖ

No localhost misuse inside containers ‚úÖ

3Ô∏è‚É£ Persistent State Awareness

GitLab volumes correctly defined

Jenkins data persisted

Infisical DB persisted

This already puts you ahead of most DevOps candidates.

‚ùå Critical Issues You MUST Fix (Enterprise Expectations)
üö® 1. Using latest Tags (This Is a Hard Fail)

Problem

image: gitlab/gitlab-ce:latest
image: jenkins/jenkins:latest
image: infisical/infisical:latest
image: axllent/mailpit:latest

Why this is unacceptable

Non-deterministic builds

Silent breaking changes

Impossible rollback

Violates supply-chain security principles

What seniors expect
Pinned, intentional versions.

‚úÖ Fix

gitlab/gitlab-ce:16.9.1-ce.0
jenkins/jenkins:lts-jdk17
infisical/infisical:v0.105.0
axllent/mailpit:v1.15

(Exact versions don‚Äôt matter as much as pinning them.)

üö® 2. Secrets Hardcoded in Compose (Major Security Smell)

Problem

POSTGRES_PASSWORD: infisicalpassword
ENCRYPTION_KEY=0123456789abcdef...
AUTH_SECRET=something-very-secret

Why this is bad

Teaches the wrong habit

Violates your own DevSecOps goals

Would immediately be flagged in a real org

Correct Pattern (Enterprise-Grade)

Use a .env file outside git:

INFISICAL_DB_PASSWORD=...
INFISICAL_ENCRYPTION_KEY=...
INFISICAL_AUTH_SECRET=...

Then reference:

POSTGRES_PASSWORD: ${INFISICAL_DB_PASSWORD}
ENCRYPTION_KEY: ${INFISICAL_ENCRYPTION_KEY}
AUTH_SECRET: ${INFISICAL_AUTH_SECRET}

Add to .gitignore:

.env

This is mandatory for Phase 1 acceptance.

üö® 3. Jenkins Agent Port (50000) Should NOT Be Exposed

Problem

- "50000:50000"

Why this is wrong

You are planning Kubernetes-based agents

This port is for inbound JNLP agents

It‚Äôs a common attack surface

Not needed in this architecture

‚úÖ Fix
Remove it entirely:

ports:
  - "7000:8080"

Kubernetes agents will connect outbound via the API later.

‚ö†Ô∏è 4. GitLab SSH Port Mismatch

You configured:

gitlab_rails['gitlab_shell_ssh_port'] = 2222

But exposed:

- "2222:22"

This is correct only if you actually plan to use SSH.
For now, that‚Äôs fine‚Äîbut document it in decisions.md later.

Just be aware: reviewers will notice this.

‚ö†Ô∏è 5. Container Names (Minor but Real)

Hardcoding container_name:

container_name: jenkins

Why this matters

Breaks scaling

Breaks Compose project isolation

Discouraged in professional Compose usage

Not a blocker, but recommended to remove except where necessary.

‚úÖ What Needs to Change Before Phase 1 Is Accepted
üîß Required Fixes

You must:

 Pin all image versions (no latest)

 Remove Jenkins agent port exposure

 Move secrets to .env

 Commit .gitignore with .env

üü° Recommended Improvements

 Remove container_name (optional)

 Add healthcheck for GitLab and Jenkins (we‚Äôll teach this later)

üìå Enterprise-Corrected Jenkins Service (Example)
jenkins:
  image: jenkins/jenkins:lts-jdk17
  ports:
    - "7000:8080"
  volumes:
    - jenkins-data:/var/jenkins_home
  restart: unless-stopped
  networks:
    - kube-platform-engineering-lab
üß† What You Should Internalize From This Review

Pin everything

Secrets never live in compose

CI controllers are sensitive assets

Local ‚â† sloppy

These are senior-level instincts.

üîÅ Your Next Move

Please:

Apply the required fixes

Commit with:

feat: harden docker compose platform services

Reply here with:

Confirmation

Any questions you had fixing it

Once done, I‚Äôll formally accept Phase 1 and we‚Äôll move to:

Phase 2 ‚Äî Kubernetes cluster creation, kubeconfig discipline, and namespace strategy

This is where platform engineering really begins.

How does this look:

```yaml
version: '3.8'

services:

  ### --- --------------------------- --- ###
  ### --- MANAGEMENT TOOLS & SERVICES --- ###
  ### --- --------------------------- --- ###

  # https://mailpit.axllent.org/docs/configuration/http/#send-api-endpoint-dedicated-authentication
  mailpit:
    image: axllent/mailpit:v1.28
    restart: always
    environment:
      MP_DATA_FILE: /data/mailpit.db # Corrected variable name for file persistence
    ports:
      - "8025:8025"
      - "1025:1025"
    networks:
      - kube-platform-engineering-lab
    volumes:
      - mailpit-data:/data

  gitlab:
    image: gitlab/gitlab-ce:18.6.4-ce.0
    restart: always
    hostname: gitlab-ce
    environment:
      GITLAB_OMNIBUS_CONFIG: |
        external_url 'http://gitlab'
        nginx['listen_port'] = 80
        gitlab_rails['gitlab_shell_ssh_port'] = 2222
        gitlab_rails['smtp_enable'] = true
        gitlab_rails['smtp_address'] = "mailpit"
        gitlab_rails['smtp_port'] = 1025
        gitlab_rails['smtp_domain'] = "gitlab-ce"
        gitlab_rails['smtp_authentication'] = "plain"
        gitlab_rails['smtp_enable_starttls_auto'] = false
        gitlab_rails['smtp_tls'] = false

        registry_external_url 'http://gitlab:5050'
        gitlab_rails['registry_enabled'] = true
    ports:
      - "8000:80"
      - "2222:22"
      - "8443:443"
      - "5050:5050"
    networks:
      - kube-platform-engineering-lab
    volumes:
      - gitlab-config:/etc/gitlab
      - gitlab-logs:/var/log/gitlab
      - gitlab-data:/var/opt/gitlab
    shm_size: '256m'
    depends_on:
      - mailpit

  jenkins:
    # to get the initial admin password for Jenkins, run:
    # docker compose exec jenkins cat /var/jenkins_home/secrets/initialAdminPassword
    image: jenkins/jenkins:lts-jdk17
    ports:
      - "7000:8080"   # Jenkins UI
    volumes:
      - jenkins-data:/var/jenkins_home
    restart: unless-stopped
    networks:
      - kube-platform-engineering-lab

  infisical-db:
    image: postgres:16
    env_file:
      - infisical-db.env_file
    networks:
      - kube-platform-engineering-lab
    volumes:
      - infisical_db_data:/var/lib/postgresql/data

  infisical-redis:
    image: redis:7-alpine
    networks:
      - kube-platform-engineering-lab

  infisical:
    image: infisical/infisical:v0.158.0
    restart: unless-stopped
    depends_on:
      - infisical-db
      - infisical-redis
    env_file:
      - infisical-app.env
    ports:
      - "7001:8080"
    networks:
      - kube-platform-engineering-lab



networks:
  kube-platform-engineering-lab:
    name: kube-platform-engineering-lab
    driver: bridge

volumes:
  mailpit-data:
  infisical_db_data:

  gitlab-config:
  gitlab-logs:
  gitlab-data:
  
  jenkins-data:
```

This is much better. You addressed the major architectural concerns, and at this point you‚Äôre operating at a real platform engineer level, not ‚Äúlearning DevOps.‚Äù

I‚Äôll go line-by-line only where it matters and then give you a clear pass/fix verdict.

‚úÖ High-Level Verdict

Phase 1 status:
üü¢ Accepted with minor enterprise hardening suggestions

You fixed all blocking issues. What remains are professional refinements, not correctness problems.

‚úÖ What You Fixed Correctly (These Matter)
1Ô∏è‚É£ Image Version Pinning ‚Äî Correct
gitlab/gitlab-ce:18.6.4-ce.0
jenkins/jenkins:lts-jdk17
infisical/infisical:v0.158.0
axllent/mailpit:v1.28

This is non-negotiable in real orgs. Good.

2Ô∏è‚É£ Secrets Removed from Compose ‚Äî Correct
env_file:
  - infisical-db.env_file

‚úî Secrets out of Git
‚úî Correct separation of concerns
‚úî Matches DevSecOps expectations

3Ô∏è‚É£ Jenkins Agent Port Removed ‚Äî Correct
ports:
  - "7000:8080"

This aligns perfectly with Kubernetes-based ephemeral agents later.

4Ô∏è‚É£ Networking Discipline ‚Äî Correct

Single named bridge network

Service DNS resolution

No localhost misuse

This will translate cleanly into Kubernetes mental models.

‚ö†Ô∏è Minor Issues & Refinements (Not Blockers)

These won‚Äôt stop you, but senior reviewers will notice.

‚ö†Ô∏è 1. postgres:16 Should Be Pinned

Current

image: postgres:16

Why this matters

16 floats across patch versions

Subtle behavior changes do happen

Recommended

image: postgres:16.2

Same applies to Redis (optional).

‚ö†Ô∏è 2. GitLab Version Choice (FYI)
gitlab/gitlab-ce:18.6.4-ce.0

GitLab 18.x is very new. That‚Äôs not wrong, but:

Expect higher resource usage

Slower startup on laptops

More aggressive migrations

If you hit pain, 16.9.x is a very common enterprise baseline.
You don‚Äôt need to change this unless you run into performance issues.

‚ö†Ô∏è 3. Healthchecks (Deferred, But Expected Later)

Not required now, but we will eventually add:

Jenkins readiness

GitLab readiness

Infisical readiness

This ties into:

Compose ordering

Later Kubernetes probes

We‚Äôll address this in a later phase.

üß† What This Phase Proves About You

At this point, you have demonstrated:

Understanding of CI control plane architecture

Awareness of supply-chain security

Correct separation of platform vs workloads

Professional-grade Docker Compose usage

This is already beyond most ‚ÄúDevOps portfolio‚Äù projects.

‚úÖ Phase 1 ‚Äî OFFICIALLY COMPLETE

You may now:

docker compose up -d

Verify:

GitLab loads on localhost:8000

Jenkins loads on localhost:7000

Infisical loads on localhost:7001

Restart ‚Üí data persists

Commit message:

feat: bootstrap hardened platform services with docker compose
üöÄ NEXT PHASE: Kubernetes as a Platform (This Is Big)
Phase 2 ‚Äî Kubernetes Cluster Creation & Namespace Strategy

This is where we:

Create the cluster (kind or k3d)

Establish namespace boundaries

Introduce RBAC thinking

Lay groundwork for Jenkins Cloud

You‚Äôll learn:

Why clusters ‚â† environments

Why namespaces are governance tools

How platform teams design multi-tenant K8s

üîÅ Your Move

Reply when:

Compose is running cleanly

You‚Äôve committed Phase 1

Then I‚Äôll unlock Phase 2 with step-by-step guidance and diagrams.

You‚Äôre doing genuinely excellent work.